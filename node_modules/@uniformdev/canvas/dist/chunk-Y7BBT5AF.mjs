import m from"p-throttle";import u from"p-retry";function l({throttle:p={interval:1e3,limit:10},retry:e={retries:1,factor:1.66}}){let t=p?m(p):null;return function(s){let i=async()=>await s();if(t&&(i=t(i)),e){let n=i;i=()=>u(n,e)}return i()}}var I=async p=>await p();var c=class extends Error{constructor(e,t,o,s,i){super(`${e}
 ${s}${i?" "+i:""} (${t} ${o})`);this.errorMessage=e;this.fetchMethod=t;this.fetchUri=o;this.statusCode=s;this.statusText=i;Object.setPrototypeOf(this,c.prototype)}},h=class{constructor(e){var t,o,s,i,n,r;if(!e.apiKey&&!e.bearerToken)throw new Error("You must provide an API key or a bearer token");this.options={...e,fetch:(t=e.fetch)!=null?t:fetch,apiHost:(o=e.apiHost)!=null?o:"https://uniform.app",apiKey:(s=e.apiKey)!=null?s:null,projectId:(i=e.projectId)!=null?i:null,bearerToken:(n=e.bearerToken)!=null?n:null,limitPolicy:(r=e.limitPolicy)!=null?r:l({})}}async getCompositionList(e){let{projectId:t}=this.options,o=this.createUrl("/api/v1/canvas",{...e,projectId:t});return await this.apiClient(o)}async getCompositionBySlug(e){let{projectId:t}=this.options,o=this.createUrl("/api/v1/canvas",{...e,projectId:t});return await this.apiClient(o)}async getCompositionById(e){let{projectId:t}=this.options,o=this.createUrl("/api/v1/canvas",{...e,projectId:t});return await this.apiClient(o)}async updateComposition(e){let t=this.createUrl("/api/v1/canvas");await this.apiClient(t,{method:"PUT",body:JSON.stringify({...e,projectId:this.options.projectId}),expectNoContent:!0})}async removeComposition(e){let t=this.createUrl("/api/v1/canvas");await this.apiClient(t,{method:"DELETE",body:JSON.stringify({...e,projectId:this.options.projectId}),expectNoContent:!0})}async getComponentDefinitions(e){let{projectId:t}=this.options,o=this.createUrl("/api/v1/canvas-definitions",{...e,projectId:t});return await this.apiClient(o)}async updateComponentDefinition(e){let t=this.createUrl("/api/v1/canvas-definitions");await this.apiClient(t,{method:"PUT",body:JSON.stringify({...e,projectId:this.options.projectId}),expectNoContent:!0})}async removeComponentDefinition(e){let t=this.createUrl("/api/v1/canvas-definitions");await this.apiClient(t,{method:"DELETE",body:JSON.stringify({...e,projectId:this.options.projectId}),expectNoContent:!0})}async apiClient(e,t){return this.options.limitPolicy(async()=>{var i;let o=this.options.apiKey?{"x-api-key":this.options.apiKey}:{Authorization:`Bearer ${this.options.bearerToken}`},s=await fetch(e.toString(),{...t,headers:{...t==null?void 0:t.headers,...o}});if(!s.ok){let n="";try{let r=await s.text();try{let a=JSON.parse(r);a.errorMessage?n=Array.isArray(a.errorMessage)?a.errorMessage.join(", "):a.errorMessage:n=r}catch(a){n=r}}catch(r){n="General error"}throw new c(n,(i=t==null?void 0:t.method)!=null?i:"GET",e.toString(),s.status)}return(t==null?void 0:t.expectNoContent)?null:await s.json()})}createUrl(e,t){let o=new URL(`${this.options.apiHost}${e}`);return Object.entries(t!=null?t:{}).forEach(([s,i])=>{var n;typeof i!==void 0&&i!==null&&o.searchParams.append(s,(n=i==null?void 0:i.toString())!=null?n:"")}),o}};var T="$personalization",L="$test",g="$localization",S="intentTag",N="locale",j="pz",x="test",E="localized",U=0,b=64;export{l as a,I as b,c,h as d,T as e,L as f,g,S as h,N as i,j,x as k,E as l,U as m,b as n};
