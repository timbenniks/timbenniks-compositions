var V=Object.create;var m=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var h=t=>m(t,"__esModule",{value:!0});var M=(t,e)=>{h(t);for(var i in e)m(t,i,{get:e[i],enumerable:!0})},O=(t,e,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of w(e))!j.call(t,n)&&n!=="default"&&m(t,n,{get:()=>e[n],enumerable:!(i=b(e,n))||i.enumerable});return t},d=t=>O(h(m(t!=null?V(k(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);M(exports,{EnrichmentClient:()=>C,IntentTagStrength:()=>g,Scope:()=>x,SignalFrequency:()=>y,SignalType:()=>a,getBehaviorIntents:()=>R,getPersonalizationIntents:()=>v,isBehaviorSignal:()=>I,isCookieSignal:()=>L,isEventSignal:()=>U,isLandingPageSignal:()=>T,isPageViewCountSignal:()=>B,isPageVisitedSignal:()=>A,isQueryStringSignal:()=>N,isStringMatch:()=>$});var g;(function(r){r[r.Antimatter=0]="Antimatter",r[r.Tangential=5]="Tangential",r[r.Weak=25]="Weak",r[r.Normal=50]="Normal",r[r.Strong=75]="Strong",r[r.Strongest=100]="Strongest",r[r.Boost=1e3]="Boost"})(g||(g={}));function R(t){return(t==null?void 0:t.intents)?Object.keys(t==null?void 0:t.intents).reduce((e,i)=>{let n=t.intents[i];return(n==null?void 0:n.noBeh)||(e[i]=n),e},{}):{}}function v(t){return(t==null?void 0:t.intents)?Object.keys(t==null?void 0:t.intents).reduce((e,i)=>{let n=t.intents[i];return(n==null?void 0:n.noPn)||(e[i]=n),e},{}):{}}var P=d(require("p-throttle")),S=d(require("p-retry"));function E({throttle:t={interval:1e3,limit:10},retry:e={retries:1,factor:1.66}}){let i=t?(0,P.default)(t):null;return function(p){let o=async()=>await p();if(i&&(o=i(o)),e){let s=o;o=()=>(0,S.default)(s,e)}return o()}}var u=class extends Error{constructor(e,i,n,p,o){super(`${e}
 ${p}${o?" "+o:""} (${i} ${n})`);this.errorMessage=e;this.fetchMethod=i;this.fetchUri=n;this.statusCode=p;this.statusText=o;Object.setPrototypeOf(this,u.prototype)}};var f=class{constructor(e){var i,n,p,o,s,r;if(!e.apiKey&&!e.bearerToken)throw new Error("You must provide an API key or a bearer token");this.options={...e,fetch:(i=e.fetch)!=null?i:fetch,apiHost:(n=e.apiHost)!=null?n:"https://uniform.app",apiKey:(p=e.apiKey)!=null?p:null,projectId:(o=e.projectId)!=null?o:null,bearerToken:(s=e.bearerToken)!=null?s:null,limitPolicy:(r=e.limitPolicy)!=null?r:E({})}}async apiClient(e,i){return this.options.limitPolicy(async()=>{var o;let n=this.options.apiKey?{"x-api-key":this.options.apiKey}:{Authorization:`Bearer ${this.options.bearerToken}`},p=await fetch(e.toString(),{...i,headers:{...i==null?void 0:i.headers,...n}});if(!p.ok){let s="";try{let r=await p.text();try{let l=JSON.parse(r);l.errorMessage?s=Array.isArray(l.errorMessage)?l.errorMessage.join(", "):l.errorMessage:s=r}catch(l){s=r}}catch(r){s="General error"}throw new u(s,(o=i==null?void 0:i.method)!=null?o:"GET",e.toString(),p.status)}return(i==null?void 0:i.expectNoContent)?null:await p.json()})}createUrl(e,i){let n=new URL(`${this.options.apiHost}${e}`);return Object.entries(i!=null?i:{}).forEach(([p,o])=>{var s;typeof o!==void 0&&o!==null&&n.searchParams.append(p,(s=o==null?void 0:o.toString())!=null?s:"")}),n}};var C=class extends f{constructor(e){super(e)}async getEnrichments(e){let{projectId:i}=this.options,n=this.createUrl("/api/v1/enrichments",{...e,projectId:i});return await this.apiClient(n)}async upsertEnrichmentCategory(e){let i=this.createUrl("/api/v1/enrichments");await this.apiClient(i,{method:"PUT",body:JSON.stringify({...e,projectId:this.options.projectId}),expectNoContent:!0})}async removeEnrichmentCategory(e){let i=this.createUrl("/api/v1/enrichments");await this.apiClient(i,{method:"DELETE",body:JSON.stringify({...e,projectId:this.options.projectId}),expectNoContent:!0})}async upsertEnrichmentValue(e){let i=this.createUrl("/api/v1/enrichment-values");await this.apiClient(i,{method:"PUT",body:JSON.stringify({...e,projectId:this.options.projectId}),expectNoContent:!0})}async removeEnrichmentValue(e){let i=this.createUrl("/api/v1/enrichment-values");await this.apiClient(i,{method:"DELETE",body:JSON.stringify({...e,projectId:this.options.projectId}),expectNoContent:!0})}};var a;(function(r){r.Cookie="CK",r.Event="EVT",r.Behavior="BEH",r.LandingPage="LP",r.PageViewCount="PVW",r.PageVisited="PVI",r.QueryString="QS"})(a||(a={}));var y;(function(n){n.OncePerVisit="visit",n.Once="once",n.Always="always"})(y||(y={}));var x;(function(i){i.Visit="visit",i.Visitor="visitor"})(x||(x={}));function L(t){return t.type==a.Cookie}function U(t){return t.type==a.Event}function I(t){return t.type==a.Behavior}function T(t){return t.type==a.LandingPage}function B(t){return t.type==a.PageViewCount}function A(t){return t.type==a.PageVisited}function N(t){return t.type==a.QueryString}function $(t,e){var p,o,s,r;let i=t,n=e==null?void 0:e.expr;switch(((p=e==null?void 0:e.cs)!=null?p:!1)||([i,n]=Q(i,n)),(o=e==null?void 0:e.type)!=null?o:"exact"){case"exact":return i===n;case"notexact":return i!==n;case"contains":return n&&(s=i==null?void 0:i.includes(n))!=null?s:!1;case"notcontains":return n?!((r=i==null?void 0:i.includes(n))!=null?r:!0):!0;case"exists":return t!==null&&typeof t!="undefined";case"notexists":return t===null||typeof t=="undefined";default:return console.warn(`Unknown string match type ${e.type} will be ignored.`),!1}}function Q(...t){return t.map(e=>e==null?void 0:e.toUpperCase())}0&&(module.exports={EnrichmentClient,IntentTagStrength,Scope,SignalFrequency,SignalType,getBehaviorIntents,getPersonalizationIntents,isBehaviorSignal,isCookieSignal,isEventSignal,isLandingPageSignal,isPageViewCountSignal,isPageVisitedSignal,isQueryStringSignal,isStringMatch});
