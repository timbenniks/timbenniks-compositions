var R=Object.create;var l=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var G=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty;var g=t=>l(t,"__esModule",{value:!0});var w=(t,s)=>{g(t);for(var r in s)l(t,r,{get:s[r],enumerable:!0})},v=(t,s,r)=>{if(s&&typeof s=="object"||typeof s=="function")for(let c of x(s))!E.call(t,c)&&c!=="default"&&l(t,c,{get:()=>s[c],enumerable:!(r=B(s,c))||r.enumerable});return t},b=t=>v(g(l(t!=null?R(G(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);w(exports,{CANVAS_BIGCOMMERCE_PARAMETER_TYPES:()=>j,createBigCommerceClient:()=>T,createBigCommerceEnhancer:()=>_,parameterIsBigCommerceProduct:()=>f,parameterIsBigCommerceProductList:()=>y,parameterIsBigCommerceProductQuery:()=>h});var C="/v3/catalog/products",O="/v3/catalog/categories/tree",$="/v3/catalog/brands",T=({storeHash:t,token:s})=>{let r=`https://api.bigcommerce.com/stores/${t}`,c=async e=>await(await fetch(e,{method:"GET",headers:{"X-Auth-Token":s}})).json();return{getProducts:async e=>{var m,i,a,u;let n=`${r}${C}`,o=new URL(n);return o.searchParams.set("include",(i=(m=e==null?void 0:e.include)==null?void 0:m.join(","))!=null?i:"images"),(e==null?void 0:e.include_fields)&&o.searchParams.set("include_fields",e.include_fields.join(",")),typeof e.limit!="undefined"&&o.searchParams.set("limit",e.limit.toString()),e.keyword&&o.searchParams.set("keyword",e.keyword),((a=e.categories)==null?void 0:a.length)&&o.searchParams.set("categories:in",e.categories.join(",")),e.brand&&o.searchParams.set("brand_id",e.brand),e.sort&&o.searchParams.set("sort",e.sort),((u=e.ids)==null?void 0:u.length)&&o.searchParams.set("id:in",e.ids.join(",")),e.sortOrder&&o.searchParams.set("direction",e.sortOrder),{products:(await c(o.toString())).data}},getProduct:async(e,n)=>{var i,a;let o=`${r}${C}`,d=new URL(o+"/"+e);return d.searchParams.set("include",(a=(i=n==null?void 0:n.include)==null?void 0:i.join(","))!=null?a:"images"),(n==null?void 0:n.include_fields)&&d.searchParams.set("include_fields",n.include_fields.join(",")),{product:(await c(d.toString())).data}},getCategories:async()=>{let e=`${r}${O}`;return{categories:(await c(e)).data}},getBrands:async()=>{let e=`${r}${$}`;return{brands:(await c(e)).data}}}};var p=b(require("@uniformdev/canvas")),j=Object.freeze(["bigcommerceProduct","bigcommerceProductQuery","bigcommerceProductList"]);function _({client:t,createProductOptions:s,createProductQueryOptions:r,limitPolicy:c}){return{enhanceOne:async({parameter:e,parameterName:n,component:o,context:d})=>{if(f(e)){let m=s==null?void 0:s({parameter:e,parameterName:n,component:o,context:d});try{return(await t.getProduct(e.value,m)).product}catch(i){throw new Error(`Failed loading BigCommerce entry ${e.value} ${i.toString()}`)}}else if(h(e)){let m=r==null?void 0:r({parameter:e,parameterName:n,component:o,context:d}),i={...e.value,limit:e.value.count,...m||{}};try{return(await t.getProducts(i)).products}catch(a){throw new Error(`Failed loading BigCommerce query ${e.value} ${a.toString()}`)}}else if(y(e)){let m={ids:e.value},i=r==null?void 0:r({parameter:e,parameterName:n,component:o,context:d}),a={...m,...i||{}};try{return(await t.getProducts(a)).products}catch(u){throw new Error(`Failed loading BigCommerce list ${e.value} ${u.toString()}`)}}},limitPolicy:c||(0,p.createLimitPolicy)({throttle:{limit:2e4,interval:60*60*1e3}})}}function f(t){return t.type==="bigcommerceProduct"&&typeof t.value=="string"}function h(t){return t.type==="bigcommerceProductQuery"&&typeof t.value=="object"}function y(t){return t.type==="bigcommerceProductList"&&Array.isArray(t.value)}0&&(module.exports={CANVAS_BIGCOMMERCE_PARAMETER_TYPES,createBigCommerceClient,createBigCommerceEnhancer,parameterIsBigCommerceProduct,parameterIsBigCommerceProductList,parameterIsBigCommerceProductQuery});
