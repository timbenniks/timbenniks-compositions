var l="/v3/catalog/products",g="/v3/catalog/categories/tree",P="/v3/catalog/brands",y=({storeHash:o,token:d})=>{let s=`https://api.bigcommerce.com/stores/${o}`,m=async e=>await(await fetch(e,{method:"GET",headers:{"X-Auth-Token":d}})).json();return{getProducts:async e=>{var i,n,c,u;let r=`${s}${l}`,t=new URL(r);return t.searchParams.set("include",(n=(i=e==null?void 0:e.include)==null?void 0:i.join(","))!=null?n:"images"),(e==null?void 0:e.include_fields)&&t.searchParams.set("include_fields",e.include_fields.join(",")),typeof e.limit!="undefined"&&t.searchParams.set("limit",e.limit.toString()),e.keyword&&t.searchParams.set("keyword",e.keyword),((c=e.categories)==null?void 0:c.length)&&t.searchParams.set("categories:in",e.categories.join(",")),e.brand&&t.searchParams.set("brand_id",e.brand),e.sort&&t.searchParams.set("sort",e.sort),((u=e.ids)==null?void 0:u.length)&&t.searchParams.set("id:in",e.ids.join(",")),e.sortOrder&&t.searchParams.set("direction",e.sortOrder),{products:(await m(t.toString())).data}},getProduct:async(e,r)=>{var n,c;let t=`${s}${l}`,a=new URL(t+"/"+e);return a.searchParams.set("include",(c=(n=r==null?void 0:r.include)==null?void 0:n.join(","))!=null?c:"images"),(r==null?void 0:r.include_fields)&&a.searchParams.set("include_fields",r.include_fields.join(",")),{product:(await m(a.toString())).data}},getCategories:async()=>{let e=`${s}${g}`;return{categories:(await m(e)).data}},getBrands:async()=>{let e=`${s}${P}`;return{brands:(await m(e)).data}}}};import{createLimitPolicy as C}from"@uniformdev/canvas";var v=Object.freeze(["bigcommerceProduct","bigcommerceProductQuery","bigcommerceProductList"]);function b({client:o,createProductOptions:d,createProductQueryOptions:s,limitPolicy:m}){return{enhanceOne:async({parameter:e,parameterName:r,component:t,context:a})=>{if(p(e)){let i=d==null?void 0:d({parameter:e,parameterName:r,component:t,context:a});try{return(await o.getProduct(e.value,i)).product}catch(n){throw new Error(`Failed loading BigCommerce entry ${e.value} ${n.toString()}`)}}else if(f(e)){let i=s==null?void 0:s({parameter:e,parameterName:r,component:t,context:a}),n={...e.value,limit:e.value.count,...i||{}};try{return(await o.getProducts(n)).products}catch(c){throw new Error(`Failed loading BigCommerce query ${e.value} ${c.toString()}`)}}else if(h(e)){let i={ids:e.value},n=s==null?void 0:s({parameter:e,parameterName:r,component:t,context:a}),c={...i,...n||{}};try{return(await o.getProducts(c)).products}catch(u){throw new Error(`Failed loading BigCommerce list ${e.value} ${u.toString()}`)}}},limitPolicy:m||C({throttle:{limit:2e4,interval:60*60*1e3}})}}function p(o){return o.type==="bigcommerceProduct"&&typeof o.value=="string"}function f(o){return o.type==="bigcommerceProductQuery"&&typeof o.value=="object"}function h(o){return o.type==="bigcommerceProductList"&&Array.isArray(o.value)}export{v as CANVAS_BIGCOMMERCE_PARAMETER_TYPES,y as createBigCommerceClient,b as createBigCommerceEnhancer,p as parameterIsBigCommerceProduct,h as parameterIsBigCommerceProductList,f as parameterIsBigCommerceProductQuery};
